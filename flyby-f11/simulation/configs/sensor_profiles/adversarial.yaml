# Adversarial Sensor Profile
# For robust training with high noise and challenging conditions
#
# Author: Finley Holt
# Date: 2025-12-27
#
# Usage:
#   This profile simulates challenging sensor conditions including:
#   - Degraded GPS (urban canyon, jamming)
#   - High IMU vibration (motor noise, turbulence)
#   - Magnetometer interference (EMI from motors, metal structures)
#   - Barometer errors (rapid altitude changes, weather fronts)
#
# Purpose:
#   Train robust controllers that can handle real-world sensor degradation.
#   Agents trained on this profile should perform well on high_fidelity
#   and real hardware.
#
# Notes:
#   - Noise levels are 3-5x typical values
#   - Sensor dropouts and failures enabled
#   - Strong wind and turbulence

profile:
  name: "adversarial"
  description: "High noise and failure modes for robust training"

sensors:
  imu:
    update_rate: 250  # Hz
    angular_velocity:
      noise:
        type: "gaussian"
        mean: 0.0
        stddev: 0.045  # 5x typical - heavy vibration
        bias_mean: 0.0005
        bias_stddev: 0.0001
    linear_acceleration:
      noise:
        type: "gaussian"
        mean: 0.0
        stddev: 0.085  # 5x typical - motor vibration
        bias_mean: 0.005
        bias_stddev: 0.001

  gps:
    update_rate: 10  # Hz (may drop to 5Hz intermittently)
    position:
      horizontal:
        noise:
          type: "gaussian"
          mean: 0.0
          stddev: 2.5  # meters - degraded GPS
      vertical:
        noise:
          type: "gaussian"
          mean: 0.0
          stddev: 5.0  # meters - poor satellite geometry
    velocity:
      horizontal:
        noise:
          type: "gaussian"
          mean: 0.0
          stddev: 0.25  # m/s
      vertical:
        noise:
          type: "gaussian"
          mean: 0.0
          stddev: 0.5  # m/s

  magnetometer:
    update_rate: 50  # Hz
    noise:
      type: "gaussian"
      mean: 0.0
      stddev: 0.005  # 5x typical - EMI interference
      bias_mean: 0.0001
      bias_stddev: 0.00002
    declination_deg: 11.5
    # Additional hard/soft iron distortion simulation
    hard_iron_offset: [0.02, -0.015, 0.01]  # Tesla
    soft_iron_scale: [1.05, 0.95, 1.0]

  barometer:
    update_rate: 20  # Hz
    reference_altitude: 0
    pressure:
      noise:
        type: "gaussian"
        mean: 0.0
        stddev: 50  # Pa - 5x typical (~6m altitude error)
    # Temperature sensitivity simulation
    temperature_drift: 0.1  # Pa/degC

  rangefinder:
    update_rate: 20  # Hz
    range:
      min: 0.1
      max: 40.0
      resolution: 0.01
    noise:
      type: "gaussian"
      mean: 0.0
      stddev: 0.1  # 5x typical - surface reflectivity issues
    # Occasional invalid readings (ground texture, angle)
    invalid_reading_probability: 0.02

# Environmental conditions
environment:
  wind:
    enabled: true
    base_speed: 8.0  # m/s - strong wind
    direction: 270  # degrees (from west)
    turbulence_intensity: 0.3  # 30% variation
    gust:
      enabled: true
      max_speed: 12.0  # m/s
      duration: 2.0  # seconds
      probability: 0.05  # per second

# Sensor failure modes
failures:
  gps_dropout:
    enabled: true
    probability: 0.01  # 1% chance per update
    duration_range: [1.0, 5.0]  # seconds
  magnetometer_interference:
    enabled: true
    probability: 0.005  # 0.5% chance per update
    magnitude_multiplier: 3.0  # 3x normal field
    duration_range: [0.5, 2.0]  # seconds
  barometer_spike:
    enabled: true
    probability: 0.002  # 0.2% chance per update
    magnitude_range: [100, 500]  # Pa
  imu_saturation:
    enabled: true
    probability: 0.001  # 0.1% chance per update
    # IMU saturates at typical MEMS limits
    max_angular_velocity: 34.9  # rad/s (2000 deg/s)
    max_acceleration: 156.96  # m/s^2 (16g)

# Simulation settings for adversarial training
training:
  # Curriculum learning: start easier, increase difficulty
  curriculum:
    enabled: true
    initial_noise_scale: 0.5
    final_noise_scale: 1.0
    ramp_episodes: 1000
  # Domain randomization
  randomization:
    enabled: true
    noise_range: [0.8, 1.2]  # multiply noise stddev
    wind_range: [0.5, 1.5]  # multiply wind parameters
    failure_rate_range: [0.5, 2.0]  # multiply failure probabilities
